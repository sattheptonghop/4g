name: Auto update clash
on:
    push:
    schedule:
    # * is a special character in YAML so you have to quote this string
    - cron:  '30 5,17 * * *'
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v2
    #  with:
    #    persist-credentials: false
    #    fetch-depth: 0
    - name: Create local changes
      run: |
        rm clash
        wget -O clash 'https://convert.v2ray-subscribe.workers.dev/?url=https://raw.githubusercontent.com/sattheptonghop/4g/main/v2ray&sni=dl.kgvn.garenanow.com&flag=clash'
    - name: Edit clash
      run: |
        sed -i 's/select,/select,/p' clash
        sed -i 's|] }|] , url: "http:\/\/www.gstatic.com\/generate_204", interval: 60}|2g' clash
        sed -i 's/select,/url-test,/1g' clash
        sed -i 's/"] }/"], url: "http:\/\/www.gstatic.com\/generate_204", interval: 60}/2g' clash
        sed -i 's/cipher: http/cipher: auto/1g' clash
        #sed -i 's/T.ME\/SHARE_V2RAY_FILE/$(date)/1g' clash
        #sed -i '/ (1)/d' clash
        #sed -i '/ (2)/d' clash
    - name: Commit files
      run: |
        git config --local user.email "tuananh88c25@gmail.com"
        git config --local user.name "sattheptonghop"
        git add clash #--all
        git commit --allow-empty -m "Add changes"
    - name: Push changes
      uses: ad-m/github-push-action@master
      with:
        github_token: ${{ secrets.GITHUB_TOKEN }}
        force: true
